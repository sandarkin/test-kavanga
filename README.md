# test-kavanga
### Тестовое задание для Kavanga
#### Формулировка
Необходимо написать приложение, которое будет отдавать код баннеров.
Приложение представляет собой http-сервер, который при вызове GET /banner/{id} отдает тело (html код) баннера.
Баннеры представлены в виде файлов с названием {id}.html, которые хранятся в известной директории.
Т.к. баннеры очень быстро теряют свою актуальность, то смысла отдавать баннер, который был создан 2 недели назад нет - все равно на него никто не кликнет. 

Задача:
* реализовать http-сервер, который при запросе /banner/{id} отдавать тело баннера
* необходима возможность загружать новые баннеры не перезапуская приложение
* баннеры, которые были загружены 2 недели назад или раньше, не должны отдаваться и могут быть удалены 
* в случае если баннер устарел или не найден, необходимо вернуть http status 404
* необходимо вести статистику по баннерам за последние 24 часа, за последние 4 часа, за последний час и за последнюю минуту:
топ 100 баннеров по количеству запросов в формате id, число запросов, дата последнего обращения
* задача должна быть решена средствами Java 7 SE, без использования сторонних библиотек, за одним исключением: для http сервера можно использовать библиотеку netty 3.9 или 5.0

#### Допущения
* используемая версия netty равна 4.0.33.Final
* в качестве id баннера используется positive integer
* максимальный размер баннера ограничен 64 KB
* имя файла баннера должно соответствовать маске ```\d+\.[htm, html, xhtml]```, например ```99.html```
* если загружается баннер с именем уже имеющиегося баннера, то старый будет перезвписан новым

### Установка и запуск
Необходимо склонировать этот репозиторий
``` 
git clone https://github.com/sandarkin/test-kavanga.git 
```
В консоле перейти в склонированную директорию и запустить приложение
* для windows
  ``` gradlew.bat run ```

* для *nix
  ``` ./gradlew run ```

Наличие в консоле строки, похожей на 
```
INFO: [id: 0x2a43dd5a, /0:0:0:0:0:0:0:0:8888] ACTIVE
```
говорит об успешном запуске приложения

### Использование
Для начала использование приложения нужно открыть в браузере адрес [http://localhost:8888/](http://localhost:8888/).

После этого произойдет переадресация на экран загрузки нового баннера

![Загрузка нового баннера](https://www.evernote.com/shard/s36/sh/bd3a13ca-e2af-47ab-ac2d-103d88925ef0/046c9173613155a5/res/f0b23d6f-1ada-458b-b8a5-3f65398fc428/skitch.png)

Здесь нужно выбрать файл загружаемого баннера и нажать кнопку "Загрузить"

![Загрузка нового баннера](https://www.evernote.com/shard/s36/sh/82eb2725-0b00-4ebf-bc59-bde435ff57e0/b0b2a49ecf90163f/res/2e256d00-3e0d-4d5d-a5c6-084e5a09bcd3/skitch.png)

После успешной загрузки отобразится страница с результатом загрузки файла нового баннера и ссылкой на него

![Результат загрузки баннера](https://www.evernote.com/shard/s36/sh/25c540eb-57de-44de-8a7c-34760cdc4505/e6b324edfba462db/res/83b15240-4837-4574-8a2b-4a30bb348968/skitch.png)

Для просмотра статистики баннеров нужно перейти по адресу [http://localhost:8888/top](http://localhost:8888/top)

![Топ100 баннеров](https://www.evernote.com/shard/s36/sh/fc554491-60a6-43d7-a78e-404dfa04587a/61501b841b6b96b6/res/0c16df36-17eb-4917-9819-62a7e929f11a/skitch.png)
